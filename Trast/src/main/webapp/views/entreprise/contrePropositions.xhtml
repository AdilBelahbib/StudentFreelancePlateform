<ui:composition xmlns="http://www.w3.org/1999/xhtml"
xmlns:h="http://java.sun.com/jsf/html"
xmlns:f="http://java.sun.com/jsf/core"
xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
xmlns:ui="http://java.sun.com/jsf/facelets"
xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
template="../templates/common.xhtml"
                xmlns:sec="http://www.springframework.org/security/tags">
	<ui:define name="content">
<c:choose>
<c:when test="${entrepriseController.entreprise.etatCompte == 'ACTIVE'}">

	<c:choose>
	<c:when test="#{not empty appelOffreController.appelOffre.contrePropositions}">
		<div class="row">
			<div class="col-md-offset-1 col-md-10">
				<h3>Les contre propositions concernants <h:outputText  value="#{appelOffreController.appelOffre.cahierDesCharges.sujet}" /></h3>				
			</div>
		</div>
		<div class="row">		
				<div class="col-md-offset-1 col-md-10">
				<h:form>
						<div class="form-group">
							<table class="table table-striped table-hover">
							<tr>
								<th>Enchere</th>
								<th>Etudiant</th>
								<th>Piece Jointe</th>
							</tr>
							<c:forEach items="#{appelOffreController.appelOffre.contrePropositions}" var="item" varStatus="statut">
							<tr>
								<td>#{item.enchere} </td>
								<!-- Visualisation du profil public de l'étudiant -->
								<td>
								 <h:commandLink action="#{profilPublicController.getInfosEtudiant}" 
            value="#{item.etudiant.nom} #{item.etudiant.prenom}">
          	<f:setPropertyActionListener
            target="#{profilPublicController.etudiant}"
            value="#{item.etudiant}" />
            </h:commandLink>
								</td>
								<td>
								<c:choose>
								<c:when test="#{ not empty item.fichier}">
								  <h:commandLink action="#{uploadFileService.downloadFile()}">Télécharger le fichier joint
									<f:setPropertyActionListener
									   target="#{uploadFileService.fileToDownload}"
										value="#{proprietes['racineuploads']}#{item.fichier.chemin}/#{item.fichier.titre}" />
								  </h:commandLink>
								</c:when>
								<c:otherwise>
									Pas de pièce jointe
								</c:otherwise>
								</c:choose>
								</td>
								<td>
									<h:commandButton value="Accepter"  action="#{appelOffreController.affecterAppelOffre}" class="btn btn-default" >
			            
										<f:setPropertyActionListener target="#{appelOffreController.contreProposition}" value="#{item}" />
									</h:commandButton>
								</td>
								
								
								<td>
									<h:commandButton value="Refuser"  action="#{appelOffreController.refuserContreProposition()}" class="btn btn-default" >
			            
										<f:setPropertyActionListener target="#{appelOffreController.contreProposition}" value="#{item}" />
									</h:commandButton>
								</td>
							</tr>
							</c:forEach>
						</table>
					</div>
						<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
					
					</h:form>
				</div>
				</div>
		</c:when>
		<c:otherwise>
		Il n'y a aucune contre-proposition pour cet appel d'offre!
		</c:otherwise>
	</c:choose>
</c:when>
<c:otherwise>
<div> votre compte n'est pas encore active!!!</div>
</c:otherwise>
</c:choose>
	</ui:define>

</ui:composition>